// Generated by CoffeeScript 1.9.3
(function(){var e;e=function(){function e(e,t){var n,r;this.options={target:"instafeed",sortBy:"none",userId:"me",links:!0,mock:!1};if(typeof e=="object")for(n in e)r=e[n],this.options[n]=r;this.context=t!=null?t:this}return e.prototype.hasNext=function(){return typeof this.context.nextUrl=="string"&&this.context.nextUrl.length>0},e.prototype.next=function(){return this.hasNext()?this.run(this.context.nextUrl):!1},e.prototype.run=function(e){var t;if(typeof this.options.accessToken!="string")throw new Error("Missing accessToken.");return this.options.before!=null&&typeof this.options.before=="function"&&this.options.before.call(this),typeof e!="string"&&(e="https://graph.instagram.com/"+this.options.userId+"/media?fields=caption,media_type,media_url,thumbnail_url,permalink,timestamp&access_token="+this.options.accessToken),t=this,fetch(e,{mode:"cors",referrer:"no-referrer",referrerPolicy:"no-referrer"}).then(function(e){return e.json()}).then(function(e){return t.parse(e),!0})},e.prototype.parse=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;if(typeof e!="object"){if(this.options.error!=null&&typeof this.options.error=="function")return this.options.error.call(this,"Invalid JSON data"),!1;throw new Error("Invalid JSON response")}if(e.data.length===0){if(this.options.error!=null&&typeof this.options.error=="function")return this.options.error.call(this,"No images were returned from Instagram"),!1;throw new Error("No images were returned from Instagram")}this.options.success!=null&&typeof this.options.success=="function"&&this.options.success.call(this,e),this.context.nextUrl="",e.next!=null&&(this.context.nextUrl=e.next);if(this.options.sortBy!=="none"){this.options.sortBy==="random"?N=["","random"]:N=this.options.sortBy.split("-"),T=N[0]==="least"?!0:!1;switch(N[1]){case"random":e.data.sort(function(){return.5-Math.random()});break;case"recent":e.data=this._sortBy(e.data,"timestamp",T);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.")}}if(typeof document!="undefined"&&document!==null&&this.options.mock===!1){w=e.data,x=parseInt(this.options.limit,10),this.options.limit!=null&&w.length>x&&(w=w.slice(0,x)),o=document.createDocumentFragment(),this.options.filter!=null&&typeof this.options.filter=="function"&&(w=this._filter(w,this.options.filter));if(this.options.template==null||typeof this.options.template!="string"&&typeof this.options.template!="function")for(p=0,g=w.length;p<g;p++)y=w[p],y.media_type==="VIDEO"?(E=document.createElement("video"),E.controls=!0,E.preload="metadata",E.poster=y.thumbnail_url,E.src=y.media_url):(E=document.createElement("img"),E.src=y.media_url),this.options.links===!0?(t=document.createElement("a"),t.href=y.permalink,t.appendChild(E),o.appendChild(t)):o.appendChild(E);else{a="",l="",k=document.createElement("div");for(u=0,d=w.length;u<d;u++){y=w[u],y.media_type==="VIDEO"?f=y.thumbnail_url:f=y.media_url,S={model:y,id:y.id,link:y.permalink,type:y.media_type,image_url:f,media_url:y.media_url,caption:y.caption},typeof this.options.template=="function"?b=this.options.template(S):b=this._makeTemplate(this.options.template,S);if(typeof b=="string")k.innerHTML+=b;else if(b instanceof Array)for(c=0,v=b.length;c<v;c++)E=b[c],k.appendChild(E);else k.appendChild(b)}i=[],r=0,n=k.childNodes.length;while(r<n)i.push(k.childNodes[r]),r+=1;for(h=0,m=i.length;h<m;h++)E=i[h],o.appendChild(E)}C=this.options.target,typeof C=="string"&&(C=document.getElementById(C));if(C==null)throw s='No element with id="'+this.options.target+'" on page.',new Error(s);C.appendChild(o)}return this.options.after!=null&&typeof this.options.after=="function"&&this.options.after.call(this),!0},e.prototype._makeTemplate=function(e,t){var n,r,i,s,o;r=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/,n=e;while(r.test(n))s=n.match(r)[1],o=(i=this._getObjectProperty(t,s))!=null?i:"",n=n.replace(r,function(){return""+o});return n},e.prototype._getObjectProperty=function(e,t){var n,r;t=t.replace(/\[(\w+)\]/g,".$1"),r=t.split(".");while(r.length){n=r.shift();if(!(e!=null&&n in e))return null;e=e[n]}return e},e.prototype._sortBy=function(e,t,n){var r;return r=function(e,r){var i,s;return i=this._getObjectProperty(e,t),s=this._getObjectProperty(r,t),n?i>s?1:-1:i<s?1:-1},e.sort(r.bind(this)),e},e.prototype._filter=function(e,t){var n,r,i,s,o;n=[],r=function(e){if(t(e))return n.push(e)};for(i=0,o=e.length;i<o;i++)s=e[i],r(s);return n},e}(),function(e,t){return typeof define=="function"&&define.amd?define([],t):typeof module=="object"&&module.exports?module.exports=t():e.Instafeed=t()}(this,function(){return e})}).call(this);
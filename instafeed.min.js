(function(){var t,e;Function.prototype.bind=Function.prototype.bind||function(t){var e,o,n,i,r;if("function"!=typeof this)throw new TypeError("Function.prototype.bind- what is trying to be bound is not callable");return e=Array.prototype.slice,r=e.call(arguments,1),i=this,o=function(){},n=function(){return i.apply(this instanceof o?this:t||window,r.concat(e.call(arguments)))},o.prototype=this.prototype,n.prototype=new o,n},t=function(){function t(t,e){var o,n;if(this.options={target:"instafeed",get:"popular",resolution:"thumbnail",sortBy:"none",links:!0,mock:!1,useHttp:!1},"object"==typeof t)for(o in t)n=t[o],this.options[o]=n;this.context=null!=e?e:this,this.unique=this._genKey()}return t.prototype.hasNext=function(){return"string"==typeof this.context.nextUrl&&this.context.nextUrl.length>0},t.prototype.next=function(){return this.hasNext()?this.run(this.context.nextUrl):!1},t.prototype.run=function(e){var o,n,i;if("string"!=typeof this.options.clientId&&"string"!=typeof this.options.accessToken)throw new Error("Missing clientId or accessToken.");if("string"!=typeof this.options.accessToken&&"string"!=typeof this.options.clientId)throw new Error("Missing clientId or accessToken.");return null!=this.options.before&&"function"==typeof this.options.before&&this.options.before.call(this),"undefined"!=typeof document&&null!==document&&(i=document.createElement("script"),i.id="instafeed-fetcher",i.src=e||this._buildUrl(),o=document.getElementsByTagName("head"),o[0].appendChild(i),n="instafeedCache"+this.unique,window[n]=new t(this.options,this),window[n].unique=this.unique),!0},t.prototype.parse=function(t){var e,o,n,i,r,s,a,p,c,l,h,u,f,d,m,g,y,w,b,k,_,v,E,I,x,N;if("object"!=typeof t){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"Invalid JSON data"),!1;throw new Error("Invalid JSON response")}if(200!==t.meta.code){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,t.meta.error_message),!1;throw new Error("Error from Instagram: "+t.meta.error_message)}if(0===t.data.length){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"No images were returned from Instagram"),!1;throw new Error("No images were returned from Instagram")}if(null!=this.options.success&&"function"==typeof this.options.success&&this.options.success.call(this,t),this.context.nextUrl="",null!=t.pagination&&(this.context.nextUrl=t.pagination.next_url),"none"!==this.options.sortBy)switch(w="random"===this.options.sortBy?["","random"]:this.options.sortBy.split("-"),g="least"===w[0]?!0:!1,w[1]){case"random":t.data.sort(function(){return.5-Math.random()});break;case"recent":t.data=this._sortBy(t.data,"created_time",g);break;case"liked":t.data=this._sortBy(t.data,"likes.count",g);break;case"commented":t.data=this._sortBy(t.data,"comments.count",g);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.")}if("undefined"!=typeof document&&null!==document&&this.options.mock===!1){if(l=t.data,null!=this.options.limit&&(o=l.length-this.options.limit,l.splice(l.length-o,o)),i=document.createDocumentFragment(),null!=this.options.filter&&"function"==typeof this.options.filter&&(l=this._filter(l,this.options.filter)),null!=this.options.template&&"string"==typeof this.options.template){for(s="",p="",u="",b=document.createElement("div"),k=0,E=l.length;E>k;k++)a=l[k],c=a.images[this.options.resolution].url,this.options.useHttp||(c=c.replace("http://","//")),p=this._makeTemplate(this.options.template,{model:a,id:a.id,link:a.link,image:c,caption:this._getObjectProperty(a,"caption.text"),likes:a.likes.count,comments:a.comments.count,location:this._getObjectProperty(a,"location.name")}),s+=p;for(b.innerHTML=s,m=function(){var t,e,o,n;for(o=b.childNodes,n=[],t=0,e=o.length;e>t;t++)y=o[t],n.push(y);return n}(),N=[].slice.call(m,0),_=0,I=N.length;I>_;_++)d=N[_],i.appendChild(d)}else for(v=0,x=l.length;x>v;v++)a=l[v],h=document.createElement("img"),c=a.images[this.options.resolution].url,this.options.useHttp||(c=c.replace("http://","//")),h.src=c,this.options.links===!0?(e=document.createElement("a"),e.href=a.link,e.appendChild(h),i.appendChild(e)):i.appendChild(h);document.getElementById(this.options.target).appendChild(i),r=document.getElementsByTagName("head")[0],r.removeChild(document.getElementById("instafeed-fetcher")),f="instafeedCache"+this.unique,window[f]=void 0;try{delete window[f]}catch(B){n=B}}return null!=this.options.after&&"function"==typeof this.options.after&&this.options.after.call(this),!0},t.prototype._buildUrl=function(){var t,e,o;switch(t="https://api.instagram.com/v1",this.options.get){case"popular":e="media/popular";break;case"tagged":if("string"!=typeof this.options.tagName)throw new Error("No tag name specified. Use the 'tagName' option.");e="tags/"+this.options.tagName+"/media/recent";break;case"location":if("number"!=typeof this.options.locationId)throw new Error("No location specified. Use the 'locationId' option.");e="locations/"+this.options.locationId+"/media/recent";break;case"user":if("number"!=typeof this.options.userId)throw new Error("No user specified. Use the 'userId' option.");if("string"!=typeof this.options.accessToken)throw new Error("No access token. Use the 'accessToken' option.");e="users/"+this.options.userId+"/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.")}return o=""+t+"/"+e,o+=null!=this.options.accessToken?"?access_token="+this.options.accessToken:"?client_id="+this.options.clientId,null!=this.options.limit&&(o+="&count="+Math.max(this.options.limit,2)),o+="&callback=instafeedCache"+this.unique+".parse"},t.prototype._genKey=function(){var t;return t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},""+t()+t()+t()+t()},t.prototype._makeTemplate=function(t,e){var o,n,i,r,s;for(n=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/,o=t;n.test(o);)i=o.match(n)[1],r=null!=(s=this._getObjectProperty(e,i))?s:"",o=o.replace(n,""+r);return o},t.prototype._getObjectProperty=function(t,e){var o,n;for(e=e.replace(/\[(\w+)\]/g,".$1"),n=e.split(".");n.length;){if(o=n.shift(),!(null!=t&&o in t))return null;t=t[o]}return t},t.prototype._sortBy=function(t,e,o){var n;return n=function(t,n){var i,r;return i=this._getObjectProperty(t,e),r=this._getObjectProperty(n,e),o?i>r?1:-1:r>i?1:-1},t.sort(n.bind(this)),t},t.prototype._filter=function(t,e){var o,n,i,r,s;for(o=[],i=function(t){return e(t)?o.push(t):void 0},r=0,s=t.length;s>r;r++)n=t[r],i(n);return o},t}(),e="undefined"!=typeof exports&&null!==exports?exports:window,e.Instafeed=t}).call(this);